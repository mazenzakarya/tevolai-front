<div class="expense-page">
  <div class="page-header">
    <h2>Expense Management</h2>
    <div class="header-stats">
      <div class="total-expense">
        <span class="label">Total Expenses:</span>
        <span class="value">${{ totalExpenses() | number : '1.2-2' }}</span>
      </div>
      <button class="btn btn-primary" (click)="openAddForm()">+ Add Expense</button>
    </div>
  </div>

  @if (showForm()) {
  <div class="modal-overlay" (click)="closeForm()">
    <div class="modal-content card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingExpense() ? 'Edit Expense' : 'Add New Expense' }}</h3>
        <button class="close-btn" (click)="closeForm()">√ó</button>
      </div>
      <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="expense-form">
        <div class="form-row">
          <div class="form-group">
            <label>Title *</label>
            <input
              formControlName="title"
              [class.error]="expenseForm.get('title')?.invalid && expenseForm.get('title')?.touched"
            />
          </div>
          <div class="form-group">
            <label>Amount *</label>
            <input
              type="number"
              formControlName="amount"
              min="0.01"
              step="0.01"
              [class.error]="
                expenseForm.get('amount')?.invalid && expenseForm.get('amount')?.touched
              "
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date *</label>
            <input
              type="date"
              formControlName="date"
              [class.error]="expenseForm.get('date')?.invalid && expenseForm.get('date')?.touched"
            />
          </div>
          <div class="form-group">
            <label>Category</label>
            <select formControlName="category">
              <option value="">Select Category</option>
              <option value="Infrastructure">Infrastructure</option>
              <option value="Domain">Domain</option>
              <option value="Office Supplies">Office Supplies</option>
              <option value="Software">Software</option>
              <option value="Marketing">Marketing</option>
              <option value="Travel">Travel</option>
              <option value="Utilities">Utilities</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Notes</label>
          <textarea formControlName="notes" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-outline" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="expenseForm.invalid">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
  } @if (isLoading()) {
  <div class="spinner"></div>
  } @else {
  <div class="expenses-table">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Title</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (expense of expenses(); track expense.id) {
        <tr>
          <td>{{ expense.date | date : 'shortDate' }}</td>
          <td>{{ expense.title }}</td>
          <td>{{ expense.category || '-' }}</td>
          <td>${{ expense.amount | number : '1.2-2' }}</td>
          <td>{{ expense.notes || '-' }}</td>
          <td>
            <button class="btn-icon" (click)="openEditForm(expense)">‚úèÔ∏è</button>
            <button class="btn-icon btn-danger" (click)="deleteExpense(expense.id!)">üóëÔ∏è</button>
          </td>
        </tr>
        } @empty {
        <tr>
          <td colspan="6" class="empty-state">No expenses found</td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  @if (totalPages() > 1 || expenses().length > 0) {
  <div class="pagination">
    <div class="page-size-selector">
      <label>Show:</label>
      <select (change)="changePageSize($any($event.target).value)" class="page-size-select">
        <option [value]="10" [selected]="pageSize() === 10">10</option>
      </select>
    </div>

    <div class="page-numbers">
      <button
        class="btn btn-outline page-btn"
        (click)="goToPage(currentPage() - 1)"
        [disabled]="currentPage() <= 1"
        [class.disabled]="currentPage() <= 1"
      >
        ‚Äπ
      </button>

      @for (page of getVisiblePages(); track page) {
      <button
        class="btn page-btn"
        [class.active]="page === currentPage()"
        [class.btn-primary]="page === currentPage()"
        [class.btn-outline]="page !== currentPage()"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
      }

      <button
        class="btn btn-outline page-btn"
        (click)="goToPage(currentPage() + 1)"
        [disabled]="currentPage() >= totalPages()"
        [class.disabled]="currentPage() >= totalPages()"
      >
        ‚Ä∫
      </button>
    </div>

    <span class="page-info">
      {{ expenses().length }} items (Page {{ currentPage() }} of {{ totalPages() }})
    </span>
  </div>
  } }
</div>
