<div class="services-on-main-page">
  <div class="page-header">
    <h2>Services on Main Page</h2>
    <button class="btn btn-primary" (click)="openAddForm()">+ Add Service</button>
  </div>

  @if (showForm()) {
  <div class="modal-overlay" (click)="closeForm()">
    <div class="modal-content card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingService() ? 'Edit Service' : 'Add New Service' }}</h3>
        <button class="close-btn" (click)="closeForm()">Ã—</button>
      </div>
      <form [formGroup]="serviceForm" (ngSubmit)="onSubmit()" class="service-form">
        <div class="form-group">
          <label>Language *</label>
          <select
            formControlName="language"
            [class.error]="
              serviceForm.get('language')?.invalid && serviceForm.get('language')?.touched
            "
          >
            <option [value]="0">English</option>
            <option [value]="1">Arabic</option>
          </select>
        </div>
        <div class="form-group">
          <label>Title *</label>
          <input
            formControlName="title"
            [class.error]="serviceForm.get('title')?.invalid && serviceForm.get('title')?.touched"
          />
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea
            formControlName="description"
            rows="4"
            [class.error]="
              serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched
            "
          ></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Price</label>
            <input type="number" formControlName="price" min="0" step="0.01" />
          </div>
          <div class="form-group">
            <label>Category</label>
            <input formControlName="category" />
          </div>
        </div>
        <div class="form-group">
          <label>Image</label>
          <input type="file" accept="image/*" (change)="onFileSelected($event)" />
          @if (imagePreview()) {
          <div class="image-preview">
            <img [src]="imagePreview()" alt="Preview" />
          </div>
          }
          <div class="form-hint">Or enter image URL:</div>
          <input
            type="url"
            formControlName="imageUrl"
            placeholder="https://example.com/image.jpg"
          />
          <div class="file-manager-hint">
            ðŸ’¡ Tip: Use the <a href="/dashboard/uploads" target="_blank">File Manager</a> to upload
            and manage images
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" formControlName="isActive" />
            Active
          </label>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-outline" (click)="closeForm()">Cancel</button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="serviceForm.invalid || uploading()"
          >
            @if (uploading()) { Uploading... } @else { Save }
          </button>
        </div>
      </form>
    </div>
  </div>
  } @if (isLoading()) {
  <div class="spinner"></div>
  } @else {
  <div class="services-grid grid grid-3">
    @for (service of services(); track service.id) {
    <div class="service-card card">
      @if (service.imageUrl) {
      <div class="service-image">
        <img [src]="service.imageUrl" [alt]="service.title" />
      </div>
      }
      <div class="service-header">
        <h3>{{ service.title }}</h3>
        <span
          class="status-badge"
          [class.active]="service.isActive"
          [class.inactive]="!service.isActive"
        >
          {{ service.isActive ? 'Active' : 'Inactive' }}
        </span>
      </div>
      <p class="service-description">{{ service.description }}</p>
      <div class="language-badge">
        {{ service.language === 0 ? 'English' : 'Arabic' }}
      </div>
      <div class="service-details">
        @if (service.price) {
        <div class="detail-item">
          <strong>Price:</strong> ${{ service.price | number : '1.2-2' }}
        </div>
        } @if (service.category) {
        <div class="detail-item"><strong>Category:</strong> {{ service.category }}</div>
        }
      </div>
      <div class="service-actions">
        <button class="btn btn-outline btn-sm" (click)="openEditForm(service)">Edit</button>
        <button class="btn btn-danger btn-sm" (click)="deleteService(service.id!)">Delete</button>
      </div>
    </div>
    } @empty {
    <div class="empty-state">No services found</div>
    }
  </div>
  }
</div>
